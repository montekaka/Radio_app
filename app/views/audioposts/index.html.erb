
    <div data-role="header" data-theme="b">    
        <h1><%=@show.name%></h1>
        <!--
            <%= link_to 'New Audio', new_show_audiopost_path(@show), {"class"=>"ui-btn-right", "data-icon" => "plus", :rel=>"external"} %>
        -->
        <a href="#infoPanel" class="ui-btn-right" data-icon="info" data-rel="push">About</a>
        <%if current_user %>
            <%= link_to 'Home', @show, {"class"=>"ui-btn-left", "data-icon" => "home"} %>
        <% end %>        
    </div>
    <div data-role="content">
        <div data-role="fieldcontain">
            <select name="select-choice-3" id="selectYearMenu" data-native-menu="false">
            <!--
            <option value="2012">2012</option>
            <option value="2011">2011</option>            
            -->
            </select>
        </div>
        <div data-role="collapsible-set" data-theme="c" data-content-theme="c" id="audiolist">
            <div data-role="collapsible">
                <h2>Hello World!</h2>
                <ul data-role="listview" data-theme="d" data-divider-theme="d" class="willisuck">
                    <li data-role="list-divider" class="audioItemDate">
                        today
                    </li>
                    <li class="audioItemTitle">
                        Let's start uploading your first audio content.
                    </li>
                </ul>
            </div>
        </div> 
    </div>
<!--info panel-->
<div data-role="panel" id="infoPanel" data-position="right" data-display="push" data-theme="a">
    <div data-role="header" data-theme="a" class="ui-corner-top">
        <h1><%=@show.name %></h1>
    </div>
    <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
        <p><strong>Show Host:</strong> <%=@show.djname%></p>
        <p><strong>Show Category:</strong> <%=@show.category%></p>
        <p><%= @show.description %></p>
    </div>
</div>
<script>

var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun",
    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];

//prepare the function we need
function currentYearArray(inputArray, DateArray, currentYear){
    var indexArray = [];
    for(var i in DateArray){
        if(DateArray[i].getFullYear() == currentYear){
            indexArray.push(i);
        }
    }
    return putArrayCorresponding(indexArray, inputArray);
}

function sortDateArray(arrayName, type){
    var dummyArray = [];
    for(var i in arrayName){
        dummyArray.push(arrayName[i]);
    }
    if(type=="descending"){
        return dummyArray.sort(function(d1, d2){
            return d2-d1;
        });
    }
    else if(type=="ascending"){
        return dummyArray.sort(function(d1, d2){
            return d1-d2;
        });
    }
    else{
        return 0;
    }
}

function getArrayIndex(sortedArray, originalArray){
    var indexArray = [];
    for(var i in sortedArray){
        indexArray.push(originalArray.indexOf(sortedArray[i]));
    }
    return indexArray;
}

function putArrayCorresponding(indexArray, inputArray){
    var outputArray = [];
    var j;
    for(var i in indexArray){
        j = indexArray[i];
        outputArray.push(inputArray[j]);
    }
    return outputArray;
}

function getUniqueArray(inputArray){
    var dummy = inputArray.filter(function(item,i,inputArray){
        return i==inputArray.indexOf(item);
    });
    return sortDateArray(dummy, "descending");
}

function getArrayMonths(inputArray){
    var audioMonths=[];
    for(var i in inputArray){
        audioMonths.push(inputArray[i].getMonth());
    }
    return audioMonths;
}

function setupHTML(inputYear){
    var currentYear = inputYear;
    
    var currentYearAudioDates = currentYearArray(audioDates,audioDates, currentYear);
    var currentYearAudioTitles = currentYearArray(aduioTitles,audioDates, currentYear);
    var currentYearAudioLinks = currentYearArray(aduioLinks,audioDates, currentYear);
    var currentYearAudioNotes = currentYearArray(aduioNotes,audioDates, currentYear);

    var descendingDates = sortDateArray(currentYearAudioDates,"descending");
    var indexDateArray = getArrayIndex(descendingDates, currentYearAudioDates);
    var newAudioTitles = putArrayCorresponding(indexDateArray, currentYearAudioTitles);
    var newAudioLinks = putArrayCorresponding(indexDateArray, currentYearAudioLinks);
    var newAudioNotes = putArrayCorresponding(indexDateArray, currentYearAudioNotes);
    var maxDate = descendingDates[0];
    var minDate = descendingDates[descendingDates.length-1];
    var maxYear = maxDate.getFullYear();
    var minYear = minDate.getFullYear();
    var maxMonth = maxDate.getMonth(); 

    var audioMonths = getArrayMonths(currentYearAudioDates);
    var uniqueMonths = getUniqueArray(audioMonths);

    //write html
    var collapsibleDiv='';
    for(var i in uniqueMonths){
        var listViewDiv='';
        var ep = 0
        for(var j in descendingDates){
            if(descendingDates[j].getMonth()==uniqueMonths[i]){
                listViewDiv = listViewDiv
                +'<li>'           
                    +'<a href="'+newAudioLinks[j]+'" data-transition="slide">'
                        +'<div class="ui-grid-b">'
                            +'<div class="ui-block-a" style="width:30%">'
                                +'<p class="calendar" style="font-size:18px">'
                                +descendingDates[j].getDate()
                                +'<em>'+monthNames[descendingDates[j].getMonth()]+'</em>'
                                +'</p>'
                            +'</div>'
                            +'<div class="ui-block-b" style="width:70%">'
                                +'<h3>'+newAudioTitles[j]+'</h3>'
                            +'</div>'                                
                        +'</div>'         
                    +'</a>'
                +'</li>';
                ep = ep+1;
            }
        }
        
        collapsibleDiv = collapsibleDiv
            +'<li data-role="list-divider">'+monthNames[uniqueMonths[i]]+' '+currentYear+'<span class="ui-li-count">'+ep+'</span>'+'</li>'+listViewDiv;
    }
    collapsibleDiv = "<ul data-role='listview' data-inset='true'>"
                        +collapsibleDiv
                    +"</ul>";
    $('#audiolist').html(collapsibleDiv);
    $('#audiolist').collapsibleset('refresh');
    $('#audiolist').trigger("create");
}

//prepare the data we need
var audioDates = [];
var audioYears = [];
var aduioLinks = [];
var aduioTitles = [];
var aduioNotes = [];
var audioCount = 0;

<% @audioposts.each do |audiopost| %>
    audioCount = audioCount + 1;    
<% end %>
if(audioCount>0){
    <% @audioposts.each do |audiopost| %>
        audioDates.push(new Date('<%= audiopost.audio_date.year%>', '<%= audiopost.audio_date.month-1%>', '<%= audiopost.audio_date.day%>'));
        aduioLinks.push('<%= show_audiopost_path(audiopost.show_id, audiopost.id)%>');
        aduioTitles.push('<%= audiopost.title%>');
        aduioNotes.push('<%= audiopost.short_note%>');        
    <% end %>
    
    $(document).bind('pageinit', function() {
        for (var i in audioDates){
            audioYears.push(audioDates[i].getFullYear());
        }
        var uniqueYear = sortDateArray(getUniqueArray(audioYears),"descending");
        var optionListOfYear = '';
        for(var i in uniqueYear){
            optionListOfYear = optionListOfYear + '<option value="'+uniqueYear[i]+'">'+uniqueYear[i]+'</option>';
        }

        $('#selectYearMenu').html(optionListOfYear);
        $('#selectYearMenu').selectmenu('refresh');

        var currentYear = sortDateArray(audioDates,"descending")[0].getFullYear();    
        setupHTML(currentYear); 
        //$('.willisuck').listview('refresh'); 
    });

    //select the year
    $("#selectYearMenu").change(function() {
        var currentYear = $(this).val();
        setupHTML(currentYear);
        $(this).selectmenu('refresh');
    });
}
</script>